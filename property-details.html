<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Property Details - VeRandA</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="nav-footer.css">
    <link rel="stylesheet" href="property-details.css">

</head>
<body>
    <!-- النافبار -->
    <div id="navbar"></div>

    <!-- قسم التفاصيل الرئيسي -->
    <div class="property-details-container" id="property-details">
        <!-- المحتوى سيتم تحميله بواسطة الجافاسكريبت -->
    </div>

    <!-- الفوتر -->
    <div id="footer"></div>
<button id="backToTopBtn" title="الرجوع للأعلى">
    <i class="fas fa-chevron-up"></i>
</button>
    <script src="main.js"></script>
    <script src="navbar.js"></script>
    <script src="property-details.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    <script>
// بيانات العقارات
const properties = [
    {
        id: 1,
        title: "Almurgan resthouse-tripoli",
        type: "resthouse",
        images: [
            "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            "https://images.unsplash.com/photo-1484154218962-a197022b5858?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1560185127-6ed189bf02f4?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1560185007-cde436f6a4d0?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        ],
        description: "Elegant rest house in prime location with stunning views and modern interior design. Perfect for relaxing getaways and business trips.",
        rooms: 4,
        capacity: 6,
        rating: 4.5,
        reviews: 128,
        pricePerNight: "1000",
        location: "Tripoli",
        address: "Tripoli",
        amenities: ["WiFi", "Swimming Pool", "Parking", "Security", "Air Conditioning"],
        bookedDates: ["2024-01-15", "2024-01-16", "2024-01-20", "2024-01-21"]
    },
    {
        id: 2,
        title: "Family estate-Alkhoums",
        type: "villa",
        images: [
            "https://images.unsplash.com/photo-1613977257363-707ba9348227?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1568605114967-8130f3a36994?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        ],
        description: "Luxury villa with private garden and pool, elegant design and spacious areas. Perfect for large families and special occasions.",
        rooms: 6,
        capacity: 10,
        rating: 4.8,
        reviews: 76,
        pricePerNight: "1500",
        location: "Alkhoums",
        address: "Alkhoums",
        amenities: ["WiFi", "Swimming Pool", "Parking", "Security", "Air Conditioning"],
        bookedDates: ["2024-01-10", "2024-01-11", "2024-01-18", "2024-01-19"]
    },
    {
        id: 3,
        title: "Sirin village-Alqweaia",
        type: "chalet",
        images: [
            "https://images.unsplash.com/photo-1513584684374-8bab748fbf90?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            "https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1571896349842-33c89424de2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        ],
        description: "Luxury chalet with sea view",
        rooms: 5,
        capacity: 8,
        rating: 4.9,
        reviews: 54,
        pricePerNight: "2000",
        location: "Alqweaia",
        address: "Alqweaia",
        amenities: ["WiFi", "Swimming Pool", "Parking", "Security", "Air Conditioning", "Gym"],
        bookedDates: ["2024-01-12", "2024-01-13", "2024-01-22", "2024-01-23"]
    },
    {
        id: 4,
        title: "Siri resthouse-tripoli",
        type: "resthouse",
        images: [
            "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            "https://images.unsplash.com/photo-1493663284031-b7e3aefcae8e?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1554995207-c18c203602cb?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1484154218962-a197022b5858?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        ],
        description: "Sea view",
        rooms: 3,
        capacity: 4,
        rating: 4.2,
        reviews: 89,
        pricePerNight: "800",
        location: "Tripoli",
        address: "Tripoli",
        amenities: ["WiFi", "Swimming Pool", "Parking", "Security", "Air Conditioning"],
        bookedDates: ["2024-01-14", "2024-01-15", "2024-01-24", "2024-01-25"]
    },
    {
        id: 5,
        title: "Royal-Alqarabulli",
        type: "villa",
        images: [
            "https://images.unsplash.com/photo-1570129477492-45c003edd2be?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            "https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1580587771525-78b9dba3b914?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        ],
        description: "Family villa with a modern design ",
        rooms: 5,
        capacity: 8,
        rating: 4.6,
        reviews: 42,
        pricePerNight: "1350",
        location: "Alqarabulli",
        address: "Alqarabulli",
        amenities: ["WiFi", "Swimming Pool", "Parking", "Security", "Air Conditioning"],
        bookedDates: ["2024-01-16", "2024-01-17", "2024-01-26", "2024-01-27"]
    },
    {
        id: 6,
        title: "Alsaraya-zuwara",
        type: "chalet",
        images: [
            "https://images.unsplash.com/photo-1540518614846-7eded102d7bf?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80",
            "https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1571896349842-33c89424de2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80",
            "https://images.unsplash.com/photo-1449824913935-59a10b8d2000?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"
        ],
        description: "Sea view.",
        rooms: 6,
        capacity: 10,
        rating: 4.7,
        reviews: 31,
        pricePerNight: "1100",
        location: "zuwara",
        address: "zuwara",
        amenities: ["WiFi", "Swimming Pool", "Parking", "Security", "Air Conditioning", "Gym"],
        bookedDates: ["2024-01-18", "2024-01-19", "2024-01-28", "2024-01-29"]
    }
];

// متغيرات التقويم
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

// دالة لتحميل تفاصيل العقار
function loadPropertyDetails() {
    const urlParams = new URLSearchParams(window.location.search);
    const propertyId = parseInt(urlParams.get('id'));
    
    const property = properties.find(p => p.id === propertyId);
    const container = document.getElementById('property-details');
    
    if (!property) {
        container.innerHTML = `
            <div class="error-message" style="text-align: center; padding: 100px 20px;">
                <h2>Property Not Found</h2>
                <p>The property you're looking for doesn't exist.</p>
                <a href="explore.html" style="color: #0077B6; text-decoration: none;">← Back to Properties</a>
            </div>
        `;
        return;
    }
    
    // توليد النجوم
    const stars = generateStars(property.rating);
    
    // التحقق من المفضلة
    const favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    const isFavorite = favorites.includes(property.id);
    
    // توليد معرض الصور
    const galleryHTML = generateGallery(property.images);
    
    // توليد المرافق
    const amenitiesHTML = generateAmenities(property.amenities);
    
    container.innerHTML = `
        <!-- معرض الصور -->
        <div class="property-gallery">
            ${galleryHTML}
        </div>
        
        <!-- المعلومات الرئيسية -->
        <div class="property-info">
            <div class="property-main-info">
                <h1>${property.title}</h1>
                <div class="property-location">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${property.location}</span>
                </div>
                
                <div class="property-price-large">
                    ${property.price}<span style="color: #0077B6;">${property.pricePerNight}</span>
                    D.L-night
                </div>
                
                <div class="property-features">
                    <div class="feature-item">
                        <i class="fas fa-door-open"></i>
                        <span>${property.rooms} Rooms</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-user-friends"></i>
                        <span>${property.capacity} People</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-bed"></i>
                        <span>${property.rooms - 1} Bedrooms</span>
                    </div>
                </div>
                
                <!-- الوصف -->
                <div class="details-section">
                    <h2>Description</h2>
                    <p class="description-text">${property.description}</p>
                </div>
                
                <!-- المرافق -->
                <div class="details-section">
                    <h2>Amenities</h2>
                    <div class="amenities-grid">
                        ${amenitiesHTML}
                    </div>
                </div>
                
                <!-- التقييم -->
                <div class="details-section">
                    <h2>Ratings & Reviews</h2>
                    <div class="rating-overview">
                        <div class="average-rating">
                            <div class="rating-number">${property.rating}</div>
                            <div class="rating-stars">${stars}</div>
                            <div class="review-count">${property.reviews} reviews</div>
                        </div>
                        <div style="flex: 1;">
                            <p style="color: #555; line-height: 1.6;">"Amazing property with excellent service. The location is perfect and the views are breathtaking!"</p>
                            <p style="color: #7f8c8d; margin-top: 10px;">- Mohammed Al-Saud</p>
                        </div>
                    </div>
                </div>
                
                <!-- الموقع -->
                <div class="details-section">
                    <h2>Location</h2>
                    <div class="location-section">
                        <div class="location-info">
                            <h3>Address</h3>
                            <p class="location-address">
                                <i class="fas fa-map-marker-alt" style="color: #e74c3c;"></i>
                                ${property.address}
                            </p>
                        </div>
                        <div class="map-container">
                            <iframe 
                                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3623.396326532936!2d46.67541531500178!3d24.713755784115!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3e2f03890d489399%3A0xba974d1c98e79fd5!2sRiyadh%2C%20Saudi%20Arabia!5e0!3m2!1sen!2s!4v1620000000000!5m2!1sen!2s" 
                                width="100%" 
                                height="100%" 
                                style="border:0;" 
                                allowfullscreen="" 
                                loading="lazy">
                            </iframe>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- الـ Sidebar (الحجز والتقويم) -->
            <div class="property-sidebar">
                <div class="booking-widget">
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <h3>Select Dates</h3>
                            <div class="calendar-nav">
                                <button onclick="changeMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                                <button onclick="changeMonth(1)"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                        <div id="calendar"></div>
                    </div>
                    
                    <div class="booking-summary">
                        <div class="booking-detail">
                            <span>Price per night:</span>
                            <span>${property.pricePerNight} D.L</span>
                        </div>
                        <div class="booking-detail">
                            <span>Nights:</span>
                            <span id="nights-count">0</span>
                        </div>
                        <div class="booking-detail">
                            <span>Service fee:</span>
                            <span id="service-fee">0 D.L</span>
                        </div>
                        <div class="booking-detail total">
                            <span>Total:</span>
                            <span id="total-price">0 D.L</span>
                        </div>
                    </div>
                    
                    <button class="booking-btn" onclick="bookProperty(${property.id})">
                        <i class="fas fa-calendar-check"></i> Book Now
                    </button>
                    <button class="favorite-btn-details ${isFavorite ? 'active' : ''}" 
                            onclick="toggleFavorite(${property.id})" id="favorite-btn">
                        <i class="${isFavorite ? 'fas' : 'far'} fa-heart"></i>
                        ${isFavorite ? 'Remove from Favorites' : 'Add to Favorites'}
                    </button>
                </div>
            </div>
        </div>
    `;
    
    // توليد التقويم بعد تحميل المحتوى
    generateCalendar(property);
}

// دالة توليد معرض الصور
function generateGallery(images) {
    const mainImage = images[0];
    const thumbnails = images.map((img, index) => `
        <div class="thumbnail" onclick="changeMainImage('${img}')">
            <img src="${img}" alt="Property Image ${index + 1}">
        </div>
    `).join('');
    
    return `
        <div class="main-image">
            <img src="${mainImage}" alt="Property Main Image" id="main-image">
        </div>
        <div class="thumbnail-grid">
            ${thumbnails}
        </div>
    `;
}

// دالة توليد المرافق
function generateAmenities(amenities) {
    const amenityIcons = {
        "WiFi": "fa-wifi",
        "Swimming Pool": "fa-swimming-pool",
        "Parking": "fa-car",
        "Gym": "fa-dumbbell",
        "Security": "fa-shield-alt",
        "Air Conditioning": "fa-snowflake"
    };
    
    return amenities.map(amenity => `
        <div class="amenity-item">
            <i class="fas ${amenityIcons[amenity] || 'fa-check'}"></i>
            <span>${amenity}</span>
        </div>
    `).join('');
}

// دالة توليد التقويم
function generateCalendar(property) {
    const calendar = document.getElementById('calendar');
    const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    
    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const startingDay = firstDay.getDay();
    
    let calendarHTML = `
        <div class="calendar-grid">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
    `;
    
    // الأيام الفارغة قبل بداية الشهر
    for (let i = 0; i < startingDay; i++) {
        calendarHTML += `<div class="calendar-day empty"></div>`;
    }
    
    // أيام الشهر
    const today = new Date();
    for (let day = 1; day <= lastDay.getDate(); day++) {
        const dateStr = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const isBooked = property.bookedDates.includes(dateStr);
        const isToday = today.getDate() === day && today.getMonth() === currentMonth && today.getFullYear() === currentYear;
        
        let dayClass = "calendar-day available";
        if (isBooked) dayClass = "calendar-day booked";
        if (isToday) dayClass += " today";
        
        calendarHTML += `<div class="${dayClass}" data-date="${dateStr}">${day}</div>`;
    }
    
    calendarHTML += `</div>`;
    calendar.innerHTML = calendarHTML;
    
    // تحديث العنوان
    document.querySelector('.calendar-header h3').textContent = 
        `${monthNames[currentMonth]} ${currentYear}`;
}

// دوال التحكم في التقويم
function changeMonth(direction) {
    currentMonth += direction;
    if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    }
    
    const propertyId = parseInt(new URLSearchParams(window.location.search).get('id'));
    const property = properties.find(p => p.id === propertyId);
    generateCalendar(property);
}

// الدوال المساعدة
function changeMainImage(imageUrl) {
    document.getElementById('main-image').src = imageUrl;
}

function bookProperty(propertyId) {
    // حفظ معرف العقار في localStorage مؤقتاً
    localStorage.setItem('currentPropertyId', propertyId);
    
    // توجيه لصفحة الحجز
    window.location.href = `booking.html?id=${propertyId}`;
}

function toggleFavorite(propertyId) {
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    const index = favorites.indexOf(propertyId);
    const button = document.getElementById('favorite-btn');
    
    if (index === -1) {
        favorites.push(propertyId);
        button.innerHTML = '<i class="fas fa-heart"></i> Remove from Favorites';
        button.classList.add('active');
    } else {
        favorites.splice(index, 1);
        button.innerHTML = '<i class="far fa-heart"></i> Add to Favorites';
        button.classList.remove('active');
    }
    
    localStorage.setItem('favorites', JSON.stringify(favorites));
}

function generateStars(rating) {
    let stars = '';
    const fullStars = Math.floor(rating);
    const hasHalfStar = rating % 1 >= 0.5;
    
    for (let i = 0; i < fullStars; i++) {
        stars += '<i class="fas fa-star"></i>';
    }
    
    if (hasHalfStar) {
        stars += '<i class="fas fa-star-half-alt"></i>';
    }
    
    const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
    for (let i = 0; i < emptyStars; i++) {
        stars += '<i class="far fa-star"></i>';
    }
    
    return stars;
}


// بدل الدوال الموجودة، استبدل الكود كله من السطر 650 إلى النهاية بهذا الكود:

// متغيرات اختيار التواريخ
let selectedCheckIn = null;
let selectedCheckOut = null;

// دالة لتحديث ملخص الحجز في صفحة التفاصيل
function updateBookingSummaryInDetails(property) {
    const nightsCount = document.getElementById('nights-count');
    const serviceFee = document.getElementById('service-fee');
    const totalPrice = document.getElementById('total-price');
    
    if (selectedCheckIn && selectedCheckOut) {
        const timeDiff = selectedCheckOut.getTime() - selectedCheckIn.getTime();
        const nights = Math.ceil(timeDiff / (1000 * 3600 * 24));
        const pricePerNight = parseInt(property.pricePerNight.replace(',', ''));
        const basePrice = pricePerNight * nights;
        const serviceFeeAmount = Math.round(basePrice * 0);
        const totalAmount = basePrice + serviceFeeAmount;
        
        nightsCount.textContent = nights;
        serviceFee.textContent = serviceFeeAmount.toLocaleString() + ' D.L';
        totalPrice.textContent = totalAmount.toLocaleString() + ' D.L';
        
        // تحديث زر الحجز
        updateBookingButton();
    } else {
        nightsCount.textContent = '0';
        serviceFee.textContent = '0 D.L';
        totalPrice.textContent = '0 D.L';
    }
}

// دالة لإعادة تعيين التحديد في التقويم
function resetCalendarSelection() {
    document.querySelectorAll('.calendar-day').forEach(day => {
        day.classList.remove('selected', 'check-in', 'check-out', 'in-range');
    });
}

// دالة لتظليل الأيام بين التواريخ المختارة
function highlightSelectedRange() {
    if (!selectedCheckIn || !selectedCheckOut) return;
    
    document.querySelectorAll('.calendar-day.available').forEach(day => {
        const dateStr = day.getAttribute('data-date');
        const date = new Date(dateStr);
        
        if (date > selectedCheckIn && date < selectedCheckOut) {
            day.classList.add('in-range');
        }
    });
}

// دالة لاختيار التواريخ في التقويم
function setupCalendarSelection(property) {
    const calendarDays = document.querySelectorAll('.calendar-day.available');
    
    calendarDays.forEach(day => {
        day.addEventListener('click', function() {
            const dateStr = this.getAttribute('data-date');
            const selectedDate = new Date(dateStr);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // منع اختيار التواريخ الماضية
            if (selectedDate < today) {
                return;
            }
            
            // إذا ما كاينش تاريخ check-in أو إذا المستخدم يبي يغير التواريخ
            if (!selectedCheckIn || (selectedCheckIn && selectedCheckOut)) {
                selectedCheckIn = selectedDate;
                selectedCheckOut = null;
                resetCalendarSelection();
                this.classList.add('selected', 'check-in');
            } else if (selectedCheckIn && !selectedCheckOut) {
                // التأكد من أن تاريخ check-out بعد check-in
                if (selectedDate > selectedCheckIn) {
                    selectedCheckOut = selectedDate;
                    this.classList.add('selected', 'check-out');
                    
                    // حفظ التواريخ في localStorage
                    saveSelectedDates(selectedCheckIn.toISOString(), selectedCheckOut.toISOString());
                    
                    // تحديث ملخص الحجز
                    updateBookingSummaryInDetails(property);
                } else {
                    // إذا تاريخ check-out قبل check-in، نبدا من جديد
                    selectedCheckIn = selectedDate;
                    selectedCheckOut = null;
                    resetCalendarSelection();
                    this.classList.add('selected', 'check-in');
                }
            }
            
            // إضافة class للمتواصل بين التواريخ
            highlightSelectedRange();
        });
    });
}

// دالة لتحميل التواريخ المختارة مسبقاً
function loadSelectedDates(property) {
    const savedDates = JSON.parse(localStorage.getItem('selectedDates'));
    if (savedDates && savedDates.checkIn && savedDates.checkOut) {
        selectedCheckIn = new Date(savedDates.checkIn);
        selectedCheckOut = new Date(savedDates.checkOut);
        
        // تحديث الواجهة
        updateBookingSummaryInDetails(property);
        highlightSelectedDatesInCalendar();
    }
}

// دالة لتظليل التواريخ المختارة في التقويم
function highlightSelectedDatesInCalendar() {
    if (!selectedCheckIn || !selectedCheckOut) return;
    
    resetCalendarSelection();
    
    document.querySelectorAll('.calendar-day.available').forEach(day => {
        const dateStr = day.getAttribute('data-date');
        const date = new Date(dateStr);
        
        if (date.getTime() === selectedCheckIn.getTime()) {
            day.classList.add('selected', 'check-in');
        } else if (date.getTime() === selectedCheckOut.getTime()) {
            day.classList.add('selected', 'check-out');
        } else if (date > selectedCheckIn && date < selectedCheckOut) {
            day.classList.add('in-range');
        }
    });
}

// دالة توليد التقويم (معدلة)
function generateCalendar(property) {
    const calendar = document.getElementById('calendar');
    const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    
    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    const startingDay = firstDay.getDay();
    
    let calendarHTML = `
        <div class="calendar-grid">
            <div class="calendar-day-header">Sun</div>
            <div class="calendar-day-header">Mon</div>
            <div class="calendar-day-header">Tue</div>
            <div class="calendar-day-header">Wed</div>
            <div class="calendar-day-header">Thu</div>
            <div class="calendar-day-header">Fri</div>
            <div class="calendar-day-header">Sat</div>
    `;
    
    // الأيام الفارغة قبل بداية الشهر
    for (let i = 0; i < startingDay; i++) {
        calendarHTML += `<div class="calendar-day empty"></div>`;
    }
    
    // أيام الشهر
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    
    for (let day = 1; day <= lastDay.getDate(); day++) {
        const dateStr = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        const date = new Date(dateStr);
        const isBooked = property.bookedDates.includes(dateStr);
        const isToday = today.getDate() === day && today.getMonth() === currentMonth && today.getFullYear() === currentYear;
        const isPast = date < today;
        
        let dayClass = "calendar-day available";
        if (isBooked) dayClass = "calendar-day booked";
        if (isToday) dayClass += " today";
        if (isPast) dayClass = "calendar-day empty";
        
        calendarHTML += `<div class="${dayClass}" data-date="${dateStr}">${day}</div>`;
    }
    
    calendarHTML += `</div>`;
    calendar.innerHTML = calendarHTML;
    
    // تحديث العنوان
    document.querySelector('.calendar-header h3').textContent = 
        `${monthNames[currentMonth]} ${currentYear}`;
    
    // إعداد اختيار التواريخ
    setupCalendarSelection(property);
    
    // تحميل التواريخ المختارة مسبقاً إذا وجدت
    loadSelectedDates(property);
}

// دوال التحكم في التقويم (معدلة)
function changeMonth(direction) {
    currentMonth += direction;
    if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    } else if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    }
    
    const propertyId = parseInt(new URLSearchParams(window.location.search).get('id'));
    const property = properties.find(p => p.id === propertyId);
    generateCalendar(property);
}

// دالة لحفظ التواريخ المختارة
function saveSelectedDates(checkIn, checkOut) {
    const dates = {
        checkIn: checkIn,
        checkOut: checkOut
    };
    localStorage.setItem('selectedDates', JSON.stringify(dates));
}

// دالة لتحديث زر الحجز في صفحة التفاصيل
function updateBookingButton() {
    const selectedDates = JSON.parse(localStorage.getItem('selectedDates'));
    if (selectedDates && selectedDates.checkIn && selectedDates.checkOut) {
        const checkIn = new Date(selectedDates.checkIn);
        const checkOut = new Date(selectedDates.checkOut);
        const checkInFormatted = checkIn.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric' 
        });
        const checkOutFormatted = checkOut.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric' 
        });
        
        // تحديث نص الزر ليعرض التواريخ المختارة
        const bookBtn = document.querySelector('.booking-btn');
        if (bookBtn) {
            bookBtn.innerHTML = `<i class="fas fa-calendar-check"></i> Book ${checkInFormatted} - ${checkOutFormatted}`;
        }
    }
}

// دالة الحجز (معدلة)
function bookProperty(propertyId) {
    // التحقق من وجود تواريخ مختارة
    const selectedDates = JSON.parse(localStorage.getItem('selectedDates'));
    if (!selectedDates || !selectedDates.checkIn || !selectedDates.checkOut) {
        alert('Please select check-in and check-out dates first.');
        return;
    }
    
    // حفظ معرف العقار في localStorage مؤقتاً
    localStorage.setItem('currentPropertyId', propertyId);
    
    // توجيه لصفحة الحجز
    window.location.href = `booking.html?id=${propertyId}`;
}

// تحميل التفاصيل عند فتح الصفحة
document.addEventListener('DOMContentLoaded', loadPropertyDetails);
    </script>


   <script type="module">
    import { PropertyAPI, CalendarAPI } from './api.js';

    // دالة جديدة لجلب بيانات العقار من API
    async function loadPropertyFromAPI(propertyId) {
        const result = await PropertyAPI.getById(propertyId);
        if (result.success && result.data) {
            return {
                id: result.data.id,
                title: result.data.name,
                description: result.data.description,
                location: result.data.location,
                pricePerNight: result.data.price.toString(),
                rooms: result.data.number_of_rooms,
                capacity: result.data.room_capacity,
                type: result.data.type,
                images: ['https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'], // صورة افتراضية
                amenities: ["WiFi", "Parking", "Air Conditioning"], // افتراضية
                rating: 4.5, // افتراضي
                reviews: 10 // افتراضي
            };
        }
        return null;
    }

    // دالة جديدة لجلب الأيام المحجوزة
    async function loadBookedDatesFromAPI(propertyId) {
        const result = await CalendarAPI.getBookedDates(propertyId);
        if (result.success) {
            // تحويل البيانات من API إلى الصيغة المطلوبة
            const bookedDates = [];
            result.data.booked_periods.forEach(period => {
                const start = new Date(period.check_in);
                const end = new Date(period.check_out);
                for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                    bookedDates.push(d.toISOString().split('T')[0]);
                }
            });
            return bookedDates;
        }
        return [];
    }

    // نعدل دالة loadPropertyDetails الحالية
    async function loadPropertyDetails() {
        const urlParams = new URLSearchParams(window.location.search);
        const propertyId = parseInt(urlParams.get('id'));
        
        // نجرب نجلب من API أولاً
        let property = await loadPropertyFromAPI(propertyId);
        let bookedDates = await loadBookedDatesFromAPI(propertyId);
        
        // إذا API ما اشتغل، نستخدم البيانات الثابتة
        if (!property) {
            property = properties.find(p => p.id === propertyId);
            if (property) {
                bookedDates = property.bookedDates || [];
            } else {
                // إذا العقار مش موجود
                showError('Property not found');
                return;
            }
        }
        
        // الباقي نفس الكود الحالي مع استخدام property و bookedDates الجديدة
        renderPropertyDetails(property, bookedDates);
    }

    // دالة لعرض العقار
    function renderPropertyDetails(property, bookedDates) {
        // هنا كود العرض الحالي - يظل كما هو
        // نستخدم property و bookedDates الجديدة
    }

    // نستبدل الاستدعاء القديم
    document.addEventListener('DOMContentLoaded', loadPropertyDetails);
</script>
</body>
</html>